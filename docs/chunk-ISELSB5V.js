import{a as q}from"./chunk-OHSN5WVE.js";import{a as we}from"./chunk-34JUEJJQ.js";import{a as Me}from"./chunk-UQKURZOD.js";import{$ as de,$a as N,Aa as Ie,Ba as V,Ca as U,E as M,Ea as j,F as te,G as ne,I as f,Ia as w,J as ie,Ja as z,K as oe,L as ae,La as ye,M as re,N as le,Oa as L,Ra as H,Sa as B,Ua as k,Wa as Ee,Xa as xe,Y as se,Z as ce,_a as R,a as J,ab as A,b as D,bb as be,c as K,ca as me,db as Te,f as C,g as Q,h as b,ha as pe,i as I,ia as ue,j as y,k as ee,l as s,m as S,ma as he,n as p,o as m,p as _,pa as F,qa as ve,ra as ge,s as r,sa as fe,t as a,ta as _e,u as g,v as T,va as Ce,w as u,wa as P,x as h,xa as $,y as d,ya as Se,z as O,za as De}from"./chunk-CJIFZG57.js";import"./chunk-A3OJPA2C.js";import"./chunk-7KGURMOZ.js";import"./chunk-C2IFOWZX.js";import"./chunk-GKGVIQI6.js";import"./chunk-A4HLURUV.js";import"./chunk-G3CV3VGG.js";import"./chunk-JGR3S45Q.js";import"./chunk-ZXS6RTUS.js";import"./chunk-RT2Q4DHF.js";import"./chunk-4U6PRYVA.js";import"./chunk-BE36LD5W.js";import"./chunk-JWIEPCRG.js";import"./chunk-QPVVTFFW.js";import"./chunk-J6ICYO4L.js";import"./chunk-LF5XB4YN.js";import{e as x}from"./chunk-XD4PSF4R.js";var G=(()=>{let i=class i{constructor(){this.dataUpdated=new J,this.baseUrlApi=Me.baseUrlApi,this.http=C(le)}createEvent(e){return D(this.http.post(`${this.baseUrlApi}/evento`,e))}getEvents(){return D(this.http.get(`${this.baseUrlApi}/eventos`))}getUserEvents(e){return D(this.http.get(`${this.baseUrlApi}/user/${e}/eventos`))}getEventById(e){return D(this.http.get(`${this.baseUrlApi}/evento/${e}`))}updateEvent(e,n){return D(this.http.put(`${this.baseUrlApi}/evento/${e}`,n))}deleteEvent(e){return D(this.http.delete(`${this.baseUrlApi}/evento/${e}`))}emitDataUpdated(){this.dataUpdated.next()}onDataUpdate(){return this.dataUpdated.asObservable()}};i.\u0275fac=function(n){return new(n||i)},i.\u0275prov=K({token:i,factory:i.\u0275fac,providedIn:"root"});let t=i;return t})();function Fe(t,i){if(t&1){let l=T();r(0,"ion-buttons",7)(1,"ion-button",14),u("click",function(){I(l);let n=h();return y(n.confirm())}),d(2,"Crear"),a()()}if(t&2){let l=h();s(),m("disabled",l.tituloControl.invalid)("strong",!0)}}function Pe(t,i){if(t&1){let l=T();r(0,"ion-buttons",7)(1,"ion-button",14),u("click",function(){I(l);let n=h();return y(n.confirm())}),d(2,"Guardar"),a()()}if(t&2){let l=h();s(),m("disabled",l.tituloControl.invalid)("strong",!0)}}function $e(t,i){t&1&&(r(0,"ion-note",10),d(1," El titulo del evento es requerido "),a())}function Ve(t,i){if(t&1){let l=T();r(0,"ion-datetime",17,1),u("ionChange",function(n){I(l);let o=h(2);return y(o.handleDate(n))}),a()}if(t&2){let l=h(2);m("value",l.actualISODate)}}function Ue(t,i){t&1&&(r(0,"ion-item")(1,"ion-label"),d(2,"Fecha"),a(),g(3,"ion-datetime-button",15),r(4,"ion-modal",16),p(5,Ve,2,1,"ng-template"),a()()),t&2&&(s(4),m("keepContentsMounted",!0))}function je(t,i){if(t&1){let l=T();r(0,"ion-datetime",19,2),u("ionChange",function(n){I(l);let o=h(2);return y(o.handleDateTime(n))}),a()}if(t&2){let l=h(2);m("value",l.actualISODate)}}function ze(t,i){t&1&&(r(0,"ion-item")(1,"ion-label"),d(2,"Fecha"),a(),g(3,"ion-datetime-button",18),r(4,"ion-modal",16),p(5,je,2,1,"ng-template"),a()()),t&2&&(s(4),m("keepContentsMounted",!0))}var W=(()=>{let i=class i{constructor(e){this.modalCtrl=e,this.userID=localStorage.getItem("userID"),this.tituloControl=new de("",se.required),this.allDay=!1}ngOnInit(){this.data.titulo?(this.actualISODate=this.formatDateToISO(new Date(this.data.fecha)),this.onlyDate=new Date(this.data.fecha),this.dateTime=new Date(this.data.fecha),this.allDay=this.data.allDay,this.tituloControl.setValue(this.data.titulo)):(this.actualISODate=this.formatDateToISO(this.data),this.onlyDate=new Date(this.data),this.dateTime=new Date(this.data))}formatDateToISO(e){let n=e.getFullYear(),o=String(e.getMonth()+1).padStart(2,"0"),c=String(e.getDate()).padStart(2,"0"),v=String(e.getHours()).padStart(2,"0"),E=String(e.getMinutes()).padStart(2,"0"),Y=String(e.getSeconds()).padStart(2,"0"),Z=String(e.getMilliseconds()).padStart(3,"0");return`${n}-${o}-${c}T${v}:${E}:${Y}.${Z}Z`}cancel(){return this.modalCtrl.dismiss(null,"cancel")}confirm(){let e={};return this.allDay?e={user_id:this.userID,titulo:this.tituloControl.getRawValue(),fecha:f(this.onlyDate,"yyyy-MM-dd","es"),allDay:!0}:e={user_id:this.userID,titulo:this.tituloControl.getRawValue(),fecha:f(this.dateTime,"yyyy-MM-dd HH:mm","es"),allDay:!1},this.modalCtrl.dismiss(e,"confirm")}handleToggle(e){this.allDay=e.detail.checked}handleDate(e){this.onlyDate=e.detail.value}handleDateTime(e){this.dateTime=e.detail.value}};i.\u0275fac=function(n){return new(n||i)(S(k))},i.\u0275cmp=b({type:i,selectors:[["app-event-detail"]],inputs:{data:"data"},standalone:!0,features:[M],decls:23,vars:5,consts:[["toggle",""],["date",""],["datetime",""],["collapse","condense",1,"ion-no-border"],["color","light"],["slot","start"],["strong","true","color","dark",3,"click"],["slot","end"],["color","light",1,"ion-padding"],["fixed","true"],["color","danger",1,"ion-margin-horizontal"],["inset","true"],["placeholder","Titulo del evento",3,"formControl"],["color","danger",3,"ionChange","checked"],["color","primary",3,"click","disabled","strong"],["datetime","date"],[3,"keepContentsMounted"],["id","date","presentation","date",3,"ionChange","value"],["datetime","datetime"],["id","datetime","presentation","date-time",3,"ionChange","value"]],template:function(n,o){if(n&1){let c=T();r(0,"ion-header",3)(1,"ion-toolbar",4)(2,"ion-buttons",5)(3,"ion-button",6),u("click",function(){return I(c),y(o.cancel())}),d(4,"Volver"),a()(),r(5,"ion-title"),d(6,"Evento"),a(),p(7,Fe,3,2,"ion-buttons",7)(8,Pe,3,2),a()(),r(9,"ion-content",8)(10,"ion-grid",9)(11,"ion-row")(12,"ion-col"),p(13,$e,2,0,"ion-note",10),r(14,"ion-list",11)(15,"ion-item"),g(16,"ion-input",12),a(),r(17,"ion-item")(18,"ion-toggle",13,0),u("ionChange",function(E){return I(c),y(o.handleToggle(E))}),d(20,"Todo el d\xEDa"),a()(),p(21,Ue,6,1,"ion-item")(22,ze,6,1),a()()()()()}n&2&&(s(7),_(7,o.data.titulo?8:7),s(6),_(13,o.tituloControl.invalid&&o.tituloControl.dirty?13:-1),s(3),m("formControl",o.tituloControl),s(2),m("checked",o.allDay),s(3),_(21,o.allDay?21:22))},dependencies:[w,Se,he,R,ye,j,z,Te,H,A,L,P,ve,F,B,V,$,U,ue,ce,me]});let t=i;return t})();function Le(t,i){t&1&&(r(0,"ion-input",8)(1,"ion-label",7)(2,"strong"),d(3,"Todo el d\xEDa"),a()()())}function He(t,i){t&1&&(r(0,"ion-input",9)(1,"ion-label",7)(2,"strong"),d(3,"Todo el d\xEDa"),a()()())}var Oe=(()=>{let i=class i{constructor(e,n){this.alertCtrl=e,this.modalController=n,this.eventsService=C(G),this.toastService=C(q),this.event=ee()}ngOnInit(){console.log()}onDelete(){return x(this,null,function*(){yield(yield this.alertCtrl.create({header:"\xBFDesea eliminar este evento?",message:"Esta evento ser\xE1 eliminado permanentemente",buttons:[{text:"Cancelar",role:"cancel"},{text:"Eliminar",role:"delete",handler:()=>{this.eventsService.deleteEvent(this.event()._id.$oid).then(n=>{this.eventsService.emitDataUpdated(),this.toastService.presentSuccessToast("top",n.mensaje)}).catch(n=>{this.toastService.presentErrorToast("top","Ha ocurrido un error")})}}]})).present()})}onClick(){return x(this,null,function*(){let e=yield this.modalController.create({component:W,componentProps:{data:this.event()}});e.present();let{data:n,role:o}=yield e.onWillDismiss();o=="confirm"&&this.eventsService.updateEvent(this.event()._id.$oid,n).then(c=>{this.eventsService.emitDataUpdated(),this.toastService.presentSuccessToast("top",c.mensaje)}).catch(c=>{this.toastService.presentErrorToast("top","Ha ocurrido un error")})})}};i.\u0275fac=function(n){return new(n||i)(S(Ee),S(k))},i.\u0275cmp=b({type:i,selectors:[["app-event-card"]],inputs:{event:[Q.SignalBased,"event"]},standalone:!0,features:[M],decls:18,vars:3,consts:[["shape","round","fill","clear",1,"trashIcon",3,"click"],["slot","icon-only","name","trash","color","danger"],["shape","round","fill","clear",1,"editIcon",3,"click"],["slot","icon-only","name","create","color","dark"],["inset","true"],["lines","none","color","light"],["readonly","true","labelPlacement","floating",3,"value"],["slot","label"],["readonly","true","labelPlacement","floating","value","Si"],["readonly","true","value","No","labelPlacement","floating"]],template:function(n,o){n&1&&(r(0,"ion-card")(1,"ion-button",0),u("click",function(){return o.onDelete()}),g(2,"ion-icon",1),a(),r(3,"ion-button",2),u("click",function(){return o.onClick()}),g(4,"ion-icon",3),a(),r(5,"ion-card-header")(6,"ion-card-title"),d(7),a()(),r(8,"ion-card-content")(9,"ion-list",4)(10,"ion-item",5)(11,"ion-input",6)(12,"ion-label",7)(13,"strong"),d(14,"Fecha"),a()()()(),r(15,"ion-item",5),p(16,Le,4,0,"ion-input",8)(17,He,4,0),a()()()()),n&2&&(s(7),O(o.event().titulo),s(4),m("value",o.event().fecha),s(5),_(16,o.event().allDay?16:17))},dependencies:[N,F,j,w,A,z,fe,Ce,_e,ge],styles:["ion-card[_ngcontent-%COMP%]{margin:8px;width:95%;position:relative}ion-card-content[_ngcontent-%COMP%]{padding:0}ion-card-header[_ngcontent-%COMP%]{padding:14px 14px 0;width:82%}ion-card-title[_ngcontent-%COMP%]{font-size:24px}.trashIcon[_ngcontent-%COMP%]{position:absolute;top:0;right:0;margin:9.5px}.editIcon[_ngcontent-%COMP%]{position:absolute;top:0;right:28px;margin:9.5px}"]});let t=i;return t})();function Be(t,i){t&1&&(r(0,"ion-title",2),d(1,"Hoy:"),a())}function Re(t,i){if(t&1&&(r(0,"ion-title",2),d(1),te(2,"date"),a()),t&2){let l=h();s(),O(ne(2,1,l.date,"longDate"," ","es"))}}function Ne(t,i){if(t&1&&(r(0,"ion-col",12),g(1,"app-event-card",15),a()),t&2){let l=i.$implicit;s(),m("event",l)}}function Ae(t,i){if(t&1&&p(0,Ne,2,1,"ion-col",14),t&2){let l=h();m("ngForOf",l.eventsResult)("ngForTrackBy",l.trackItems)}}function qe(t,i){t&1&&(r(0,"ion-col",16)(1,"ion-label",17),d(2,"No tienes eventos en esta fecha"),a()())}function Ge(t,i){if(t&1&&(r(0,"ion-col",12),g(1,"app-event-card",15),a()),t&2){let l=i.$implicit;s(),m("event",l)}}function We(t,i){if(t&1&&p(0,Ge,2,1,"ion-col",14),t&2){let l=h();m("ngForOf",l.nextEvents)("ngForTrackBy",l.trackItems)}}function Ye(t,i){t&1&&(r(0,"ion-col",16)(1,"ion-label",17),d(2,"No tienes pr\xF3ximos eventos"),a()())}ie(we,"es");var wt=(()=>{let i=class i{constructor(e,n){this.modalController=e,this.loadingController=n,this.eventService=C(G),this.toastService=C(q),this.eventService.onDataUpdate().subscribe(()=>this.loadEvents()),this.userID=localStorage.getItem("userID"),this.events=[],this.eventsResult=[],this.nextEvents=[],this.date=new Date(f(new Date,"yyyy-MM-dd HH:mm","es")),this.actualISODate=this.formatDateToISO(this.date)}ngOnInit(){this.loadEvents()}formatDateToISO(e){let n=e.getFullYear(),o=String(e.getMonth()+1).padStart(2,"0"),c=String(e.getDate()).padStart(2,"0"),v=String(e.getHours()).padStart(2,"0"),E=String(e.getMinutes()).padStart(2,"0"),Y=String(e.getSeconds()).padStart(2,"0"),Z=String(e.getMilliseconds()).padStart(3,"0");return`${n}-${o}-${c}T${v}:${E}:${Y}.${Z}Z`}loadEvents(){this.showLoading(),this.eventService.getUserEvents(this.userID).then(e=>{this.events=e,this.eventsResult=this.events.filter(n=>this.checkDate(n.fecha)),this.nextEvents=this.events.filter(n=>this.checkNextEvents(n.fecha)),this.loadingController.dismiss()}).catch(e=>{this.loadingController.dismiss(),this.toastService.presentErrorToast("top","Ha ocurrido un error")})}checkSameDate(){let e=f(this.date,"yyyy-MM-dd","es"),n=f(new Date,"yyyy-MM-dd","es");return e==n}showLoading(){return x(this,null,function*(){(yield this.loadingController.create({message:"Loading..."})).present()})}handleDate(e){this.date=new Date(e.detail.value),this.eventsResult=this.events.filter(n=>this.checkDate(n.fecha)),this.nextEvents=this.events.filter(n=>this.checkNextEvents(n.fecha))}checkDate(e){let n=new Date(e),o=f(this.date,"yyyy-MM-dd","es"),c=f(n,"yyyy-MM-dd","es");return o==c}checkNextEvents(e){let n=new Date(e),o=f(n,"yyyy-MM-dd","es"),c=f(this.date,"yyyy-MM-dd","es"),v=new Date(c);return new Date(o)>v}handleInput(e){let n=e.target.value.toLowerCase();this.eventsResult=this.events.filter(o=>this.checkDate(o.fecha)&&o.titulo.toLowerCase().indexOf(n)>-1),this.nextEvents=this.events.filter(o=>this.checkNextEvents(o.fecha)&&o.titulo.toLowerCase().indexOf(n)>-1)}trackItems(e,n){return n._id}createEvent(){return x(this,null,function*(){let e=yield this.modalController.create({component:W,componentProps:{data:this.date}});e.present();let{data:n,role:o}=yield e.onWillDismiss();o=="confirm"&&this.eventService.createEvent(n).then(c=>{this.eventService.emitDataUpdated(),this.toastService.presentSuccessToast("top",c.mensaje)}).catch(c=>{this.toastService.presentErrorToast("top","Ha ocurrido un error")})})}};i.\u0275fac=function(n){return new(n||i)(S(k),S(xe))},i.\u0275cmp=b({type:i,selectors:[["app-calendar-main"]],standalone:!0,features:[M],decls:26,vars:4,consts:[["collapse","condense",1,"ion-no-border"],["color","light",1,"ion-padding-top"],["size","large"],["color","light"],["slot","fixed","vertical","bottom","horizontal","end"],["size","small","color","danger",3,"click"],["name","add"],[1,"ion-justify-content-center"],["size","12","sizeSm","6","sizeMd","5","sizeLg","4","sizeXl","3"],["color","danger","presentation","date","locale","es-ES",3,"ionChange","value"],["placeholder","Buscar","animated","true","inputmode","search",3,"ionInput"],[1,"ion-justify-start","ion-margin-bottom"],["size","12","sizeMd","6","sizeLg","4"],[1,"ion-justify-start"],["size","12","sizeMd","6","sizeLg","4",4,"ngFor","ngForOf","ngForTrackBy"],[2,"width","97%",3,"event"],[1,"messageCol"],[1,"messageEmpty"]],template:function(n,o){n&1&&(r(0,"ion-header",0)(1,"ion-toolbar",1)(2,"ion-title",2),d(3," Calendario "),a()()(),r(4,"ion-content",3)(5,"ion-fab",4)(6,"ion-fab-button",5),u("click",function(){return o.createEvent()}),g(7,"ion-icon",6),a()(),r(8,"ion-grid")(9,"ion-row",7)(10,"ion-col",8)(11,"ion-datetime",9),u("ionChange",function(v){return o.handleDate(v)}),a(),r(12,"ion-searchbar",10),u("ionInput",function(v){return o.handleInput(v)}),a()()(),r(13,"ion-row")(14,"ion-col"),p(15,Be,2,0,"ion-title",2)(16,Re,3,6),a()(),r(17,"ion-row",11),p(18,Ae,1,2,"ion-col",12)(19,qe,3,0),a(),r(20,"ion-row")(21,"ion-title",2),d(22,"Pr\xF3ximos eventos:"),a()(),r(23,"ion-row",13),p(24,We,1,2,"ion-col",12)(25,Ye,3,0),a()()()),n&2&&(s(11),m("value",o.actualISODate),s(4),_(15,o.checkSameDate()?15:16),s(3),_(18,o.eventsResult.length?18:19),s(6),_(24,o.nextEvents.length?24:25))},dependencies:[Oe,be,P,L,V,N,Ie,De,R,w,$,U,H,B,re,oe,ae,pe],styles:["ion-datetime[_ngcontent-%COMP%]{border-radius:24px}ion-col[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;margin:0;padding:0}.messageEmpty[_ngcontent-%COMP%]{font-size:18px;font-weight:500}.messageCol[_ngcontent-%COMP%]{align-items:flex-start;padding-inline:12px}"]});let t=i;return t})();export{wt as CalendarMainPage};
